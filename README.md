# 计算机图形学——旋转光照球
# 一、设计内容（功能需求描述）

任务：设计一个多光源光照球演示系统。

功能：

（1）可以采用菜单或其他方式选择光源位置（位置设定为上（Y轴正向）、  右（x轴正向）、前（z轴正向））；

（2）能够选择光源颜色（红（右）、绿（上）、蓝（前）或其他颜色）；

（3）选择材质（默认红宝石、绿宝石、金色或其他颜色）；

（4）可以通过选择光源的位置，光源颜色和材质实现不同的光照球效果；

（5）光源可以在X轴，Y轴和Z轴上移动或在平面上以某种轨迹动态移动（ 比如：在xoy平面、yoz平面、xoz平面上绕Z轴、X轴、Y轴沿圆形轨道运行）；


# 二、设计思想和实现方法（说明总体框架，模块实现流程及编程方法）

## 2.1总体框架

CMy105View类：继承自CView，负责视图的显示和用户交互。包含光照球演示系统的各种功能，如绘制球体、透视变换、颜色渐变填充等。

CVector类：表示矢量，用于计算光照和法矢量插值等。

CFace类：表示面，包含面的顶点索引和法矢量等信息。

CLight类：表示光源，包含光源的位置、颜色和衰减系数等信息。

CMaterial类：表示材质，包含材质的反射率和高光指数等信息。

CLighting类：表示光照环境，包含多个光源和环境光的信息。

CZBuffer类：表示Z缓冲区，用于颜色渐变填充和深度测试。

## 2.2模块实现流程

（1）读取点表和面表：

①　在CMy105View类中的ReadPoint函数中，根据球体的纬度和经度参数计算顶点的坐标，并保存在P数组中。

②　在CMy105View类中的ReadFace函数中，根据点表生成面表，并计算每个面片的法矢量。

（2）初始化参数：

①　在CMy105View类中的InitParameter函数中，根据视点的球坐标和透视投影参数计算透视变换所需的常量k。

②　初始化其他参数，如视距d、动画开关MPlay和光源旋转开关LPlay等。

（3）透视投影和双缓冲：

①　在CMy105View类中的DoubleBuffer函数中，创建一个兼容的内存DC，并创建一个兼容的位图作为双缓冲区。

②　在DrawObject函数中，对球体的每个顶点进行透视变换，并保存在ScreenP中。

③　在DrawObject函数中，根据光源和材质的参数，调用Phong函数进行颜色渐变填充。

④　将绘制结果绘制到双缓冲区中，并使用BitBlt函数将双缓冲区的内容复制到屏幕上，避免闪烁。

（4）光照和颜色渐变填充：

①　在CZBuffer类中的Phong函数中，根据顶点的屏幕坐标和法矢量，使用Phong光照模型计算颜色。

②　根据光源的位置和衰减系数，计算光源对顶点的光照强度。

③　根据材质的反射率和高光指数，计算漫反射光和镜面反射光的贡献。

④　在CZBuffer类中的Interpolation函数中，对法矢量进行线性插值，以获得每个像素点的法矢量。

⑤　在CZBuffer类中的BucketSort函数中，对ET表进行排序，以确保边按照从左到右的顺序处理。

## 2.3编程方法

①　使用面向对象的编程方法，将功能模块化，提高代码的可读性和维护性。

②　使用合适的数据结构存储和操作数据，如使用数组、链表等来存储顶点和面的数据。

③　使用适当的算法和数学公式来进行透视变换、颜色渐变填充等计算。

④　使用消息映射机制来处理用户的输入和菜单操作。

⑤　使用双缓冲技术来提高绘制效率和消除闪烁。

# 四、总结分析

## 4.1遇到的问题

光照计算复杂：光照模型的计算涉及到多个光源、材质和法向量等参数，需要仔细理解和实现。

球体的绘制：球体的点表和面表相比立方体复杂很多，需要仔细设计。

## 4.2解决方案

研究光照模型：深入理解光照模型的原理和计算方法，确保准确实现。

球体绘制：通过经纬度模型实现球体的绘制。

## 4.3收获与体会

通过设计和实现多光源光照球演示系统，我收获了很多： 

首先，我深入了解了光照模型和渲染算法的原理和实现方法。通过研究光照模型，我学会了如何计算漫反射和镜面反射光的强度，以及如何考虑光照衰减和环境光的影响。这让我对计算机图形学的光照效果有了更深入的理解。

其次，我学会了使用合适的数据结构和算法来处理复杂的图形渲染任务。在设计过程中，我使用了点表、面表、活性边表等数据结构，并采用了适当的算法来进行光照计算、颜色填充和深度测试。这让我了解了如何优化算法和数据结构，以提高渲染性能和效率。

此外，我还学到了如何处理用户交互和界面设计。通过设计用户界面和选择菜单，我使得用户可以自由地选择光源位置、颜色和材质等参数，从而更好地观察和理解光照效果。这让我明白了用户体验的重要性，以及如何设计友好的用户界面。

在解决问题的过程中，我遇到了一些困难和挑战。但通过不断学习和尝试，我克服了这些困难，并逐步提高了自己的解决问题的能力和创造力。我深刻体会到了持之以恒、勇于尝试的重要性，这些经验对我今后的工作和学习都将大有裨益。

总的来说，通过设计和实现多光源光照球演示系统，我不仅加深了对计算机图形学的理解，还培养了解决问题和团队合作的能力。这对我的个人成长和职业发展都具有重要意义。我将继续努力学习和探索，不断提高自己在图形学领域的专业能力和创新能力。

# 五、参考文献

《计算机图形学基础教程（Visual C++版）》（第二版），孔令德编，清华大学出版社，

2013 年 3 月出版。

# 六、附录

程序运行截图：
![image](https://github.com/yanyanlai/rotating-illuminated-sphere/assets/110188868/f28bd15c-4cb0-4ca0-baf9-e0fe7b652dcf)
![image](https://github.com/yanyanlai/rotating-illuminated-sphere/assets/110188868/f4cd3bdc-fbc5-4266-9004-dc160f16ef56)
![image](https://github.com/yanyanlai/rotating-illuminated-sphere/assets/110188868/27461aaa-ab01-43b1-8658-e2d60ee6b352)

